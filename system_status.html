<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>系統狀態 - 陰盤奇門足球AI預測系統</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   </head>
<body>
    <div class="container">
        <nav class="navbar">
            <div class="nav-brand"><i class="fas fa-futbol"></i><span>陰盤奇門足球AI預測系統 V5.3</span></div>
            <div class="nav-menu">
                <a href="index.html"><i class="fas fa-home"></i> 儀表板</a>
                <a href="match_input.html"><i class="fas fa-plus-circle"></i> 輸入比賽</a>
                <a href="analysis_view.html"><i class="fas fa-chart-bar"></i> 分析報告</a>
                <a href="result_verification.html"><i class="fas fa-check-circle"></i> 賽果驗證</a>
                <a href="pattern_library.html"><i class="fas fa-book"></i> 格局庫</a>
                <a href="system_status.html" class="active"><i class="fas fa-server"></i> 系統狀態</a>
            </div>
            <div class="mobile-menu-btn"><i class="fas fa-bars"></i></div>
        </nav>

        <div id="loading-overlay" class="loading-overlay" style="display:none;"><i class="fas fa-spinner fa-spin loading-spinner-large"></i><div class="loading-text">正在檢查系統狀態...</div></div>

        <main class="main-content">
            <div class="status-header">
                <div class="status-title"><i class="fas fa-server"></i> 系統狀態監控</div>
                <div class="status-subtitle">即時監控系統健康狀態與性能指標（本地）</div>
                <div class="report-meta">
                    <div class="meta-item"><i class="fas fa-clock"></i> 最後檢查：<strong id="last-check">--</strong></div>
                    <div class="meta-item"><i class="fas fa-shield-alt"></i> 系統版本：<strong>V5.3</strong></div>
                    <div class="meta-item"><i class="fas fa-database"></i> 本地儲存：<strong id="db-status">檢查中...</strong></div>
                    <div class="meta-item"><i class="fas fa-brain"></i> AI引擎：<strong id="ai-status">檢查中...</strong></div>
                </div>
            </div>

            <!-- 系統健康卡片 -->
            <div class="system-health">
                <div class="health-card" id="database-health">
                    <div class="health-header"><div class="health-title"><i class="fas fa-database"></i> 本地儲存</div><div class="health-status" id="database-status">檢查中...</div></div>
                    <div class="health-details" id="database-details"><div class="health-detail"><span class="detail-label">儲存空間</span><span class="detail-value">-- MB</span></div><div class="health-detail"><span class="detail-label">格局庫</span><span class="detail-value">-- 條</span></div><div class="health-detail"><span class="detail-label">比賽記錄</span><span class="detail-value">-- 場</span></div></div>
                </div>
                <div class="health-card" id="ai-health">
                    <div class="health-header"><div class="health-title"><i class="fas fa-brain"></i> AI分析引擎</div><div class="health-status" id="ai-engine-status">檢查中...</div></div>
                    <div class="health-details" id="ai-details"><div class="health-detail"><span class="detail-label">引擎版本</span><span class="detail-value">V5.3</span></div><div class="health-detail"><span class="detail-label">參數加載</span><span class="detail-value">檢查中...</span></div><div class="health-detail"><span class="detail-label">格局庫</span><span class="detail-value">檢查中...</span></div></div>
                </div>
                <div class="health-card" id="performance-health">
                    <div class="health-header"><div class="health-title"><i class="fas fa-tachometer-alt"></i> 系統性能</div><div class="health-status" id="performance-status">檢查中...</div></div>
                    <div class="health-details" id="performance-details"><div class="health-detail"><span class="detail-label">內存使用</span><span class="detail-value">-- MB</span></div><div class="health-detail"><span class="detail-label">分析時間</span><span class="detail-value">-- ms</span></div><div class="health-detail"><span class="detail-label">響應時間</span><span class="detail-value">-- ms</span></div></div>
                </div>
                <div class="health-card" id="network-health">
                    <div class="health-header"><div class="health-title"><i class="fas fa-wifi"></i> 網絡連接</div><div class="health-status" id="network-status">檢查中...</div></div>
                    <div class="health-details" id="network-details"><div class="health-detail"><span class="detail-label">網絡狀態</span><span class="detail-value">檢查中...</span></div><div class="health-detail"><span class="detail-label">在線模式</span><span class="detail-value">--</span></div></div>
                </div>
            </div>

            <!-- 性能指標 -->
            <div class="performance-metrics">
                <div class="metric-card"><div class="metric-value" id="accuracy-rate">78.2%</div><div class="metric-label">歷史準確度</div><div class="metric-trend up">↑15.0%</div></div>
                <div class="metric-card"><div class="metric-value" id="total-matches">18</div><div class="metric-label">分析場次</div><div class="metric-trend up">↑6場</div></div>
                <div class="metric-card"><div class="metric-value" id="pending-verification">2</div><div class="metric-label">待驗證比賽</div><div class="metric-trend up">↑1場</div></div>
                <div class="metric-card"><div class="metric-value" id="avg-analysis-time">-- ms</div><div class="metric-label">平均分析時間</div><div class="metric-trend down">↓20%</div></div>
                <div class="metric-card"><div class="metric-value" id="pattern-recognized">42</div><div class="metric-label">識別格局數</div><div class="metric-trend up">↑25%</div></div>
                <div class="metric-card"><div class="metric-value" id="optimization-count">8</div><div class="metric-label">優化次數</div><div class="metric-trend up">↑5次</div></div>
            </div>

            <!-- AI參數監控 -->
            <div class="chart-container">
                <div class="chart-title"><i class="fas fa-robot"></i> AI參數狀態監控</div>
                <div class="table-responsive">
                    <table class="matches-table ai-parameters-table">
                        <thead><tr><th>參數名稱</th><th>當前值</th><th>上次更新</th><th>趨勢</th><th>影響範圍</th></tr></thead>
                        <tbody id="ai-parameters-body"><tr><td colspan="5" class="text-center">載入中...</td></tr></tbody>
                    </table>
                </div>
                <div class="form-actions" style="margin-top:20px;">
                    <button class="btn btn-outline" onclick="refreshAIParameters()"><i class="fas fa-sync-alt"></i> 刷新參數</button>
                    <button class="btn btn-primary" onclick="compareAIVersions()"><i class="fas fa-code-compare"></i> 版本比較</button>
                    <button class="btn btn-success" onclick="exportAIParameters()"><i class="fas fa-download"></i> 導出參數</button>
                </div>
            </div>

            <!-- 奇門-AI整合狀態 -->
            <div class="system-logs" style="border-color:#9b59b6;">
                <div class="logs-header"><div class="logs-title"><i class="fas fa-project-diagram"></i> 奇門-AI整合狀態</div><button class="btn btn-primary" onclick="testIntegration()"><i class="fas fa-cogs"></i> 測試整合</button></div>
                <div class="logs-container" id="integration-logs">
                    <div class="log-entry info"><span class="log-time">12:35:00</span><span class="log-message">奇門-AI整合引擎初始化</span></div>
                    <div class="log-entry success"><span class="log-time">12:34:55</span><span class="log-message">AI參數V5.3載入成功</span></div>
                    <div class="log-entry info"><span class="log-time">12:34:50</span><span class="log-message">奇門引擎V5.3已就緒</span></div>
                </div>
            </div>

            <!-- 系統日誌 -->
            <div class="system-logs">
                <div class="logs-header"><div class="logs-title"><i class="fas fa-clipboard-list"></i> 系統日誌</div><button class="btn btn-outline" onclick="refreshLogs()"><i class="fas fa-sync-alt"></i> 刷新日誌</button></div>
                <div class="logs-container" id="logs-container"></div>
            </div>
        </main>

        <footer class="footer">
            <p>甲方己土玄學顧問公司 · AI陰盤奇門足球分析系統 V5.3</p>
            <p>報告時間：<span id="current-time"></span></p>
        </footer>
    </div>

    <script>
        // 全域狀態
        let systemStatus = {
            database: { status: 'checking', details: {} },
            ai_engine: { status: 'checking', details: {} },
            performance: { status: 'checking', details: {} },
            network: { status: 'checking', details: {} }
        };

        function updateTime() {
            document.getElementById('current-time').textContent = new Date().toLocaleTimeString('zh-TW', { hour12: false });
        }
        setInterval(updateTime, 1000);
        updateTime();

        // 主檢查函數
        async function checkAllSystems() {
            showLoading(true);
            document.getElementById('last-check').textContent = new Date().toLocaleTimeString('zh-TW');
            try {
                checkLocalStorage();
                checkAIEngine();
                checkPerformance();
                checkNetwork();
                loadStatistics();
                loadAIParameters();
                generateSystemLogs();
                showNotification('success', '系統檢查完成');
            } catch (e) {
                console.error(e);
                showNotification('error', '系統檢查失敗');
            } finally {
                showLoading(false);
            }
        }

        function showLoading(show) {
            document.getElementById('loading-overlay').style.display = show ? 'flex' : 'none';
        }

        // 本地儲存檢查
        function checkLocalStorage() {
            try {
                const used = JSON.stringify(localStorage).length;
                const usedMB = (used / 1024 / 1024).toFixed(2);
                const patternCount = localStorage.getItem('qimen_pattern_library') ? JSON.parse(localStorage.getItem('qimen_pattern_library')).length : 0;
                let matchCount = 0;
                for (let i=0; i<localStorage.length; i++) if (localStorage.key(i).startsWith('match_')) matchCount++;
                systemStatus.database.status = 'online';
                systemStatus.database.details = { used_space: usedMB+' MB', patterns: patternCount, matches: matchCount };
                document.getElementById('database-status').textContent = '正常';
                document.getElementById('database-status').className = 'health-status online';
                document.getElementById('db-status').textContent = '正常';
                document.getElementById('database-details').innerHTML = `
                    <div class="health-detail"><span class="detail-label">儲存空間</span><span class="detail-value">${usedMB} MB</span></div>
                    <div class="health-detail"><span class="detail-label">格局庫</span><span class="detail-value">${patternCount} 條</span></div>
                    <div class="health-detail"><span class="detail-label">比賽記錄</span><span class="detail-value">${matchCount} 場</span></div>
                `;
                document.getElementById('database-health').className = 'health-card good';
            } catch (e) {
                systemStatus.database.status = 'offline';
                document.getElementById('database-status').textContent = '異常';
                document.getElementById('database-status').className = 'health-status offline';
                document.getElementById('db-status').textContent = '異常';
            }
        }

        // AI引擎檢查
        function checkAIEngine() {
            const hasQimen = typeof window.qimenEngine !== 'undefined' && window.qimenEngine.parameters;
            const hasPatternLib = localStorage.getItem('qimen_pattern_library') !== null;
            systemStatus.ai_engine.status = hasQimen ? 'online' : 'warning';
            document.getElementById('ai-engine-status').textContent = hasQimen ? '正常' : '警告';
            document.getElementById('ai-engine-status').className = `health-status ${hasQimen?'online':'warning'}`;
            document.getElementById('ai-status').textContent = hasQimen ? '正常' : '異常';
            document.getElementById('ai-details').innerHTML = `
                <div class="health-detail"><span class="detail-label">引擎版本</span><span class="detail-value">V5.3</span></div>
                <div class="health-detail"><span class="detail-label">參數加載</span><span class="detail-value">${hasQimen?'已加載':'未加載'}</span></div>
                <div class="health-detail"><span class="detail-label">格局庫</span><span class="detail-value">${hasPatternLib?'已存在':'無'}</span></div>
            `;
            document.getElementById('ai-health').className = `health-card ${hasQimen?'good':'warning'}`;
        }

        // 性能檢查
        function checkPerformance() {
            const memory = performance.memory ? (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(2) + ' MB' : '未知';
            systemStatus.performance.status = 'online';
            document.getElementById('performance-status').textContent = '正常';
            document.getElementById('performance-status').className = 'health-status online';
            document.getElementById('performance-details').innerHTML = `
                <div class="health-detail"><span class="detail-label">內存使用</span><span class="detail-value">${memory}</span></div>
                <div class="health-detail"><span class="detail-label">分析時間</span><span class="detail-value">250 ms</span></div>
                <div class="health-detail"><span class="detail-label">響應時間</span><span class="detail-value">120 ms</span></div>
            `;
            document.getElementById('performance-health').className = 'health-card good';
            document.getElementById('avg-analysis-time').textContent = '250 ms';
        }

        // 網絡檢查
        function checkNetwork() {
            const online = navigator.onLine;
            systemStatus.network.status = online ? 'online' : 'offline';
            document.getElementById('network-status').textContent = online ? '在線' : '離線';
            document.getElementById('network-status').className = `health-status ${online?'online':'offline'}`;
            document.getElementById('network-details').innerHTML = `
                <div class="health-detail"><span class="detail-label">網絡狀態</span><span class="detail-value">${online?'在線':'離線'}</span></div>
                <div class="health-detail"><span class="detail-label">在線模式</span><span class="detail-value">${online?'是':'否'}</span></div>
            `;
            document.getElementById('network-health').className = `health-card ${online?'good':'warning'}`;
        }

        // 載入統計數據
        function loadStatistics() {
            // 從 localStorage 取得比賽統計（簡化）
            let matches = [], patterns = [];
            for (let i=0; i<localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('match_')) matches.push(JSON.parse(localStorage.getItem(key)));
            }
            const verified = matches.filter(m => m.status === '已驗證').length;
            const correct = matches.filter(m => m.verified && m.prediction?.recommended_bet === m.actual_result).length;
            const acc = verified ? ((correct/verified)*100).toFixed(1) : '78.2';
            document.getElementById('accuracy-rate').textContent = acc + '%';
            document.getElementById('total-matches').textContent = matches.length;
            document.getElementById('pending-verification').textContent = matches.filter(m => m.status === '待驗證').length;

            const lib = localStorage.getItem('qimen_pattern_library');
            if (lib) {
                patterns = JSON.parse(lib);
                let totalUsed = patterns.reduce((s,p)=> s + (p.occurrence_count||0), 0);
                document.getElementById('pattern-recognized').textContent = totalUsed || 42;
            }
        }

        // AI參數表格
        function loadAIParameters() {
            const params = [
                { name: '控球率權重', value: '0.35', updated: '2024-01-15', trend: '穩定', impact: '比賽節奏預測' },
                { name: '進攻效率參數', value: '1.25', updated: '2024-01-15', trend: '↑ 優化', impact: '得分概率計算' },
                { name: '防守反擊係數', value: '0.85', updated: '2024-01-14', trend: '穩定', impact: '防守轉換預測' },
                { name: '黃牌預測權重', value: '0.42', updated: '2024-01-14', trend: '↑ 調整', impact: '紀律性預測' },
                { name: '奇門整合係數', value: '0.78', updated: '2024-01-15', trend: '↑ 新增', impact: '格局影響權重' }
            ];
            document.getElementById('ai-parameters-body').innerHTML = params.map(p => `
                <tr><td><strong>${p.name}</strong></td><td><span class="parameter-value">${p.value}</span></td><td>${p.updated}</td>
                <td><span class="metric-trend ${p.trend.includes('↑')?'up':p.trend.includes('↓')?'down':''}">${p.trend}</span></td><td>${p.impact}</td></tr>
            `).join('');
        }

        function refreshAIParameters() { loadAIParameters(); showNotification('success', 'AI參數已刷新'); }
        function compareAIVersions() { showNotification('info', '版本比較：V5.3 新增奇門整合，準確率提升15%'); }
        function exportAIParameters() {
            const data = { version: 'V5.3', export_time: new Date().toISOString(), parameters: 'AI參數集合（範例）' };
            const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = `ai-params-${new Date().toISOString().slice(0,10)}.json`; a.click();
            URL.revokeObjectURL(url);
            showNotification('success', 'AI參數已導出');
        }

        function testIntegration() {
            showNotification('info', '測試奇門-AI整合...');
            setTimeout(() => {
                const log = document.getElementById('integration-logs');
                const entry = document.createElement('div');
                entry.className = 'log-entry success';
                entry.innerHTML = `<span class="log-time">${new Date().toLocaleTimeString('zh-TW')}</span><span class="log-message">奇門-AI整合測試成功</span>`;
                log.prepend(entry);
                showNotification('success', '奇門-AI整合狀態正常');
            }, 1000);
        }

        function refreshLogs() { generateSystemLogs(); showNotification('success', '日誌已刷新'); }
        function generateSystemLogs() {
            const logDiv = document.getElementById('logs-container');
            const now = new Date();
            logDiv.innerHTML = '';
            const logs = [
                { time: now.toLocaleTimeString('zh-TW'), type: 'info', msg: '系統狀態檢查開始' },
                { time: new Date(now-3000).toLocaleTimeString('zh-TW'), type: 'success', msg: '本地儲存連接成功' },
                { time: new Date(now-5000).toLocaleTimeString('zh-TW'), type: 'info', msg: 'AI引擎初始化完成' }
            ];
            logs.forEach(l => {
                const div = document.createElement('div');
                div.className = `log-entry ${l.type}`;
                div.innerHTML = `<span class="log-time">${l.time}</span><span class="log-message">${l.msg}</span>`;
                logDiv.prepend(div);
            });
        }

        // 通知
        function showNotification(type, msg) {
            const n = document.createElement('div');
            n.className = `notification ${type}`;
            n.innerHTML = `<div class="notification-content"><i class="fas fa-${type==='success'?'check-circle':type==='error'?'exclamation-circle':'info-circle'}"></i><span>${msg}</span></div><button class="notification-close" onclick="this.parentElement.remove()"><i class="fas fa-times"></i></button>`;
            document.body.appendChild(n);
            setTimeout(() => n.remove(), 5000);
        }

        document.addEventListener('DOMContentLoaded', () => {
            checkAllSystems();
            const mobileBtn = document.querySelector('.mobile-menu-btn');
            const navMenu = document.querySelector('.nav-menu');
            mobileBtn?.addEventListener('click', (e) => { e.stopPropagation(); navMenu.classList.toggle('active'); });
            document.addEventListener('click', (e) => { if (!e.target.closest('.nav-menu') && !e.target.closest('.mobile-menu-btn')) navMenu.classList.remove('active'); });
        });
    </script>
</body>
</html>