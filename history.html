<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­·å²é©—è­‰ - å·±åœŸå¥‡é–€ç³»çµ±</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“Š</text></svg>">
    <style>
        /* æ­·å²é é¢å°ˆç”¨æ¨£å¼ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: linear-gradient(135deg, white, #f8f9fa);
            border-radius: var(--border-radius);
            padding: 30px;
            text-align: center;
            box-shadow: var(--shadow);
            border: 1px solid #e0e0e0;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--third-color);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--third-color), #ff9a3c);
        }
        
        .stat-value {
            font-size: 3.5rem;
            font-weight: 800;
            margin: 15px 0;
            background: linear-gradient(135deg, var(--third-color), #ff9a3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
        }
        
        .stat-label {
            color: var(--second-color);
            font-size: 1.1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stat-detail {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-top: 10px;
        }
        
        /* æº–ç¢ºç‡é¡è‰²é¡ */
        .accuracy-high { 
            background: linear-gradient(135deg, var(--success-color), #2ecc71) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
        }
        
        .accuracy-medium { 
            background: linear-gradient(135deg, var(--warning-color), #f1c40f) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
        }
        
        .accuracy-low { 
            background: linear-gradient(135deg, var(--danger-color), #c0392b) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
        }
        
        /* é€²åº¦æ¢æ¨£å¼ */
        .progress-section {
            margin: 40px 0;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .progress-bar {
            height: 20px;
            background: var(--fourth-color);
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--third-color), #ff9a3c);
            border-radius: 10px;
            transition: width 1s ease-in-out;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.4), 
                transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--second-color);
            margin-top: 10px;
        }
        
        /* è¶¨å‹¢åœ–å®¹å™¨ */
        .trend-chart {
            background: linear-gradient(135deg, #f8f9fa, white);
            border-radius: var(--border-radius);
            padding: 30px;
            margin: 25px 0;
            border: 1px solid #e0e0e0;
            min-height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .trend-chart::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--third-color), transparent);
        }
        
        /* æ­·å²è¨˜éŒ„è¡¨æ ¼ */
        .history-table-container {
            overflow-x: auto;
            margin: 30px 0;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            background: white;
        }
        
        .history-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
        }
        
        .history-table th {
            background: linear-gradient(135deg, var(--first-color), var(--second-color));
            color: white;
            padding: 20px;
            text-align: left;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.9rem;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .history-table th:first-child {
            border-top-left-radius: var(--border-radius);
        }
        
        .history-table th:last-child {
            border-top-right-radius: var(--border-radius);
        }
        
        .history-table td {
            padding: 18px 20px;
            border-bottom: 1px solid #eee;
            color: var(--first-color);
            vertical-align: middle;
        }
        
        .history-table tr:hover {
            background: linear-gradient(90deg, rgba(249, 109, 0, 0.05), transparent);
        }
        
        .history-table tr:last-child td {
            border-bottom: none;
        }
        
        /* ç‹€æ…‹æ¨™ç±¤ */
        .match-status {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-pending {
            background: linear-gradient(135deg, var(--warning-color), #f1c40f);
            color: white;
            animation: pulse 2s infinite;
        }
        
        .status-verified {
            background: linear-gradient(135deg, var(--success-color), #2ecc71);
            color: white;
        }
        
        .status-incorrect {
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
            color: white;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        /* æº–ç¢ºç‡å–®å…ƒæ ¼ */
        .accuracy-cell {
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        /* è¡¨æ ¼æ“ä½œæŒ‰éˆ• */
        .table-actions {
            display: flex;
            gap: 8px;
        }
        
        .table-btn {
            padding: 8px 16px;
            border: none;
            border-radius: var(--border-radius-sm);
            font-size: 0.85rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
        }
        
        .table-btn.view {
            background: linear-gradient(135deg, var(--info-color), #2980b9);
            color: white;
        }
        
        .table-btn.edit {
            background: linear-gradient(135deg, var(--warning-color), #f39c12);
            color: white;
        }
        
        .table-btn.delete {
            background: linear-gradient(135deg, var(--danger-color), #c0392b);
            color: white;
        }
        
        .table-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        /* è¡¨æ ¼åº•éƒ¨ */
        .table-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: var(--fourth-color);
            border-bottom-left-radius: var(--border-radius);
            border-bottom-right-radius: var(--border-radius);
        }
        
        /* æ ¼å±€çµ±è¨ˆ */
        .patterns-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
            margin: 30px 0;
        }
        
        @media (min-width: 768px) {
            .patterns-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .pattern-stat {
            background: linear-gradient(135deg, white, #f8f9fa);
            border-radius: var(--border-radius);
            padding: 25px;
            border: 1px solid #e0e0e0;
        }
        
        .pattern-stat h4 {
            color: var(--first-color);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--third-color);
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .pattern-stat ul {
            list-style: none;
            padding: 0;
        }
        
        .pattern-stat li {
            padding: 12px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .pattern-stat li:last-child {
            border-bottom: none;
        }
        
        .pattern-name {
            font-weight: 600;
            color: var(--first-color);
        }
        
        .pattern-accuracy {
            background: var(--third-color);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 700;
        }
        
        /* AIå­¸ç¿’å»ºè­° */
        .ai-learning {
            background: linear-gradient(135deg, var(--first-color), var(--second-color));
            color: white;
            border-radius: var(--border-radius);
            padding: 30px;
            margin-top: 30px;
        }
        
        .ai-learning h4 {
            color: white;
            margin-bottom: 20px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .ai-learning ul {
            list-style: none;
            padding-left: 20px;
        }
        
        .ai-learning li {
            padding: 10px 0;
            position: relative;
        }
        
        .ai-learning li::before {
            content: 'â–¶';
            position: absolute;
            left: -20px;
            color: var(--third-color);
        }
        
        /* ç©ºç‹€æ…‹ */
        .empty-state {
            text-align: center;
            padding: 80px 40px;
            color: var(--second-color);
        }
        
        .empty-state i {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 20px;
        }
        
        .empty-state h3 {
            color: var(--second-color);
            margin-bottom: 15px;
        }
        
        /* éŸ¿æ‡‰å¼èª¿æ•´ */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stat-value {
                font-size: 2.5rem;
            }
            
            .history-table-container {
                margin: 20px -15px;
                border-radius: 0;
            }
            
            .table-footer {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }
            
            .table-actions {
                justify-content: center;
            }
        }
        
        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .patterns-grid {
                grid-template-columns: 1fr;
            }
            
            .table-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="main-header">
            <div class="logo-section">
                <h1><i class="fas fa-history"></i> æ­·å²é©—è­‰è¨˜éŒ„</h1>
                <p class="version">ç³»çµ±æº–ç¢ºç‡è¿½è¹¤èˆ‡åˆ†æ</p>
            </div>
            <nav class="main-nav">
                <a href="index.html"><i class="fas fa-home"></i> è¼¸å…¥ä»‹é¢</a>
                <a href="prediction.html"><i class="fas fa-chart-line"></i> ç•¶å‰é æ¸¬</a>
                <a href="history.html" class="active"><i class="fas fa-history"></i> æ­·å²é©—è­‰</a>
                <a href="ai-params.html"><i class="fas fa-brain"></i> AIåƒæ•¸</a>
                <a href="lazy-commands.html"><i class="fas fa-terminal"></i> æŒ‡ä»¤åŒ…</a>
            </nav>
        </header>

        <main>
            <!-- çµ±è¨ˆæ•¸æ“š -->
            <section class="card">
                <h2><i class="fas fa-chart-bar"></i> ç³»çµ±è¡¨ç¾çµ±è¨ˆ</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">ç¸½é æ¸¬å ´æ¬¡</div>
                        <div class="stat-value" id="total-predictions">15</div>
                        <div class="stat-detail">å…¶ä¸­ 14 å ´å·²å®Œæˆé©—è­‰</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">æ•´é«”æº–ç¢ºç‡</div>
                        <div class="stat-value accuracy-high" id="overall-accuracy">73.3%</div>
                        <div class="stat-detail">è¼ƒä¸Šé€±æå‡ +2.1%</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">è³½æœæº–ç¢ºç‡</div>
                        <div class="stat-value accuracy-medium" id="result-accuracy">66.7%</div>
                        <div class="stat-detail">10/15 å ´æ­£ç¢º</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-label">è§’çƒæº–ç¢ºç‡</div>
                        <div class="stat-value accuracy-low" id="corner-accuracy">60.0%</div>
                        <div class="stat-detail">9/15 å ´æº–ç¢º</div>
                    </div>
                </div>
                
                <div class="progress-section">
                    <div class="progress-header">
                        <h4>80%æº–ç¢ºç‡ç›®æ¨™é€²åº¦</h4>
                        <span id="progress-percentage">73.3%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="target-progress" style="width: 73.3%"></div>
                    </div>
                    <div class="progress-text">
                        <span>ç›®å‰é€²åº¦ï¼š<strong id="current-progress">73.3%</strong></span>
                        <span>ç›®æ¨™ï¼š<strong>80%</strong></span>
                        <span>é‚„éœ€ï¼š<strong id="remaining-progress">6.7%</strong></span>
                    </div>
                </div>
            </section>

            <!-- è¶¨å‹¢åœ–è¡¨ -->
            <section class="card">
                <h2><i class="fas fa-chart-line"></i> æº–ç¢ºç‡è¶¨å‹¢</h2>
                <div class="trend-chart" id="trend-chart">
                    <div class="empty-state">
                        <i class="fas fa-chart-line"></i>
                        <h3>æº–ç¢ºç‡è¶¨å‹¢åœ–è¡¨</h3>
                        <p>æ­¤è™•å¯é›†æˆ Chart.js æˆ–é¡ä¼¼åœ–è¡¨åº«</p>
                        <p>é¡¯ç¤ºæº–ç¢ºç‡éš¨æ™‚é–“çš„è®ŠåŒ–è¶¨å‹¢</p>
                        <div class="trend-indicators">
                            <div style="margin-top: 20px; padding: 15px; background: rgba(249, 109, 0, 0.1); border-radius: 8px;">
                                <p><strong>æœ€è¿‘è¶¨å‹¢ï¼š</strong> éå»5å ´æ¯”è³½æº–ç¢ºç‡æŒçºŒä¸Šå‡</p>
                                <p><strong>æœ€ä½³è¡¨ç¾ï¼š</strong> ç¬¬12å ´æ¯”è³½é”åˆ°85%æº–ç¢ºç‡</p>
                                <p><strong>éœ€è¦æ”¹é€²ï¼š</strong> è§’çƒé æ¸¬ç©©å®šæ€§</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- æ­·å²è¨˜éŒ„è¡¨æ ¼ -->
            <section class="card">
                <h2><i class="fas fa-table"></i> è©³ç´°æ­·å²è¨˜éŒ„</h2>
                
                <div class="history-table-container">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th width="100">æ¯”è³½ID</th>
                                <th width="200">ä¸»éšŠ vs å®¢éšŠ</th>
                                <th width="100">é æ¸¬çµæœ</th>
                                <th width="100">å¯¦éš›çµæœ</th>
                                <th width="80">æº–ç¢ºåº¦</th>
                                <th width="100">ç‹€æ…‹</th>
                                <th width="120">æ—¥æœŸ</th>
                                <th width="180">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="history-body">
                            <!-- æ­·å²æ•¸æ“šå°‡å‹•æ…‹ç”Ÿæˆ -->
                        </tbody>
                    </table>
                    
                    <div class="empty-state" id="empty-history" style="display: none;">
                        <i class="fas fa-inbox"></i>
                        <h3>æš«ç„¡æ­·å²è¨˜éŒ„</h3>
                        <p>é‚„æ²’æœ‰ä»»ä½•æ¯”è³½é æ¸¬è¨˜éŒ„</p>
                        <button class="btn-primary" onclick="window.location.href='index.html'">
                            <i class="fas fa-plus"></i> é–‹å§‹ç¬¬ä¸€å ´é æ¸¬
                        </button>
                    </div>
                </div>
                
                <div class="table-footer">
                    <div class="pagination-info">
                        é¡¯ç¤º <span id="start-index">1</span> - <span id="end-index">10</span> æ¢ï¼Œå…± <span id="total-items">15</span> æ¢è¨˜éŒ„
                    </div>
                    <div class="table-actions">
                        <button class="btn-secondary" onclick="exportHistory()">
                            <i class="fas fa-download"></i> å°å‡ºæ­·å²æ•¸æ“š
                        </button>
                        <button class="btn-secondary" onclick="importHistory()">
                            <i class="fas fa-upload"></i> å°å…¥æ•¸æ“š
                        </button>
                        <button class="btn-secondary" onclick="clearHistory()">
                            <i class="fas fa-trash"></i> æ¸…é™¤æ­·å²
                        </button>
                    </div>
                </div>
            </section>

            <!-- æœ‰æ•ˆæ ¼å±€çµ±è¨ˆ -->
            <section class="card">
                <h2><i class="fas fa-star"></i> æœ‰æ•ˆå¥‡é–€æ ¼å±€çµ±è¨ˆ</h2>
                
                <div class="patterns-grid">
                    <div class="pattern-stat">
                        <h4><i class="fas fa-thumbs-up"></i> æœ€æœ‰æ•ˆçš„æ ¼å±€çµ„åˆ</h4>
                        <ul id="effective-patterns">
                            <li>
                                <span class="pattern-name">é›¢ç«å…‹å…Œé‡‘</span>
                                <span class="pattern-accuracy">85%</span>
                            </li>
                            <li>
                                <span class="pattern-name">å€¼ç¬¦+ç”Ÿé–€</span>
                                <span class="pattern-accuracy">80%</span>
                            </li>
                            <li>
                                <span class="pattern-name">ç©ºäº¡æœé–€</span>
                                <span class="pattern-accuracy">78%</span>
                            </li>
                            <li>
                                <span class="pattern-name">å¤©è¼”+å‰é–€</span>
                                <span class="pattern-accuracy">75%</span>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="pattern-stat">
                        <h4><i class="fas fa-thumbs-down"></i> éœ€è¦èª¿æ•´çš„æ ¼å±€</h4>
                        <ul id="ineffective-patterns">
                            <li>
                                <span class="pattern-name">æœ±é›€å…¥å¢“</span>
                                <span class="pattern-accuracy">45%</span>
                            </li>
                            <li>
                                <span class="pattern-name">æ™¯é–€é–€è¿«</span>
                                <span class="pattern-accuracy">50%</span>
                            </li>
                            <li>
                                <span class="pattern-name">å¤©èŠ®+å‡¶é–€</span>
                                <span class="pattern-accuracy">55%</span>
                            </li>
                        </ul>
                    </div>
                </div>
                
                <div class="ai-learning">
                    <h4><i class="fas fa-lightbulb"></i> AIå­¸ç¿’å»ºè­°</h4>
                    <p>æ ¹æ“šæ­·å²æ•¸æ“šåˆ†æï¼Œå»ºè­°èª¿æ•´ä»¥ä¸‹åƒæ•¸ï¼š</p>
                    <ul>
                        <li>å¢åŠ ã€Œé›¢ç«å…‹å…Œé‡‘ã€æ ¼å±€æ¬Šé‡è‡³ <strong>40%</strong></li>
                        <li>é™ä½ã€Œæœ±é›€å…¥å¢“ã€å½±éŸ¿æ¬Šé‡è‡³ <strong>15%</strong></li>
                        <li>æ–°å¢ã€Œç©ºäº¡+æœé–€ã€ç‚ºé«˜æ¬Šé‡å› å­ (<strong>+35%</strong>)</li>
                        <li>æ”¶é›†æ›´å¤šå¥³å­æ¯”è³½æ•¸æ“šä»¥å„ªåŒ–æ€§åˆ¥å› å­</li>
                        <li>å»ºè­°æ¸¬è©¦ã€Œé™½é4å±€ã€çš„æ–°æ ¼å±€çµ„åˆ</li>
                    </ul>
                </div>
            </section>
        </main>

        <footer class="main-footer">
            <p>å·±åœŸç„å­¸é¡§å•å…¬å¸ Â© 2026 | æ­·å²é©—è­‰ç³»çµ± v1.1</p>
            <p class="disclaimer">æ•¸æ“šåƒ…å­˜å„²æ–¼æœ¬åœ°ç€è¦½å™¨ | æœ€å¾Œæ›´æ–°: <span id="last-update-time"></span></p>
        </footer>
    </div>

    <!-- è©³æƒ…æ¨¡æ…‹æ¡† -->
    <div id="detail-modal" class="modal">
        <div class="modal-content" style="max-width: 800px; text-align: left;">
            <span class="close-modal" onclick="closeDetailModal()">&times;</span>
            <h2 id="modal-title">æ¯”è³½è©³æƒ…</h2>
            <div id="modal-content">
                <!-- è©³æƒ…å…§å®¹å°‡å‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script src="js/data-manager.js"></script>
    <script>
        // é é¢åŠ è¼‰å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('æ­·å²é©—è­‰é é¢å·²åŠ è¼‰');
            loadHistoryData();
            updateStats();
            updateLastUpdateTime();
            
            // è¨­ç½®è‡ªå‹•åˆ·æ–°
            setInterval(updateLastUpdateTime, 60000); // æ¯åˆ†é˜æ›´æ–°æ™‚é–“
        });
        
        // åŠ è¼‰æ­·å²æ•¸æ“š
        function loadHistoryData() {
            const history = JSON.parse(localStorage.getItem('qimenMatchHistory') || '[]');
            const tableBody = document.getElementById('history-body');
            const emptyState = document.getElementById('empty-history');
            
            if (history.length === 0) {
                tableBody.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            // æŒ‰æ™‚é–“å€’åºæ’åˆ—
            history.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            // ç”Ÿæˆè¡¨æ ¼è¡Œ
            let html = '';
            history.forEach((match, index) => {
                const isVerified = match.actualResult?.verified || false;
                const actualScore = match.actualResult?.finalScore || 'å¾…é©—è­‰';
                const predictedResult = match.predictions?.result || 'æœªé æ¸¬';
                const accuracy = match.aiLearning?.accuracy || 0;
                
                // ç¢ºå®šç‹€æ…‹
                let status = 'å¾…é©—è­‰';
                let statusClass = 'status-pending';
                
                if (isVerified) {
                    if (accuracy >= 70) {
                        status = 'æº–ç¢º';
                        statusClass = 'status-verified';
                    } else {
                        status = 'ä¸æº–ç¢º';
                        statusClass = 'status-incorrect';
                    }
                }
                
                // ç¢ºå®šæº–ç¢ºç‡é¡¯ç¤º
                let accuracyDisplay = isVerified ? `${accuracy}%` : '-';
                let accuracyClass = '';
                
                if (isVerified) {
                    if (accuracy >= 70) accuracyClass = 'accuracy-high';
                    else if (accuracy >= 60) accuracyClass = 'accuracy-medium';
                    else accuracyClass = 'accuracy-low';
                }
                
                // æ ¼å¼åŒ–æ—¥æœŸ
                const matchDate = new Date(match.matchInfo?.date || match.timestamp);
                const dateStr = matchDate.toLocaleDateString('zh-Hant', {
                    month: 'short',
                    day: 'numeric'
                });
                
                html += `
                    <tr>
                        <td><strong>${match.matchId || 'N/A'}</strong></td>
                        <td>
                            <div style="font-weight: 600;">${match.matchInfo?.homeTeam || 'ä¸»éšŠ'}</div>
                            <div style="color: var(--second-color); font-size: 0.9em;">vs</div>
                            <div>${match.matchInfo?.awayTeam || 'å®¢éšŠ'}</div>
                        </td>
                        <td><strong>${predictedResult}</strong></td>
                        <td><strong>${actualScore}</strong></td>
                        <td class="accuracy-cell ${accuracyClass}">${accuracyDisplay}</td>
                        <td><span class="match-status ${statusClass}">${status}</span></td>
                        <td>${dateStr}</td>
                        <td>
                            <div class="table-actions">
                                <button class="table-btn view" onclick="viewMatchDetail(${index})">
                                    <i class="fas fa-eye"></i> æŸ¥çœ‹
                                </button>
                                <button class="table-btn edit" onclick="editMatch(${index})" ${isVerified ? 'disabled style="opacity:0.5;"' : ''}>
                                    <i class="fas fa-edit"></i> ç·¨è¼¯
                                </button>
                                <button class="table-btn delete" onclick="deleteMatch(${index})">
                                    <i class="fas fa-trash"></i> åˆªé™¤
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
            
            // æ›´æ–°åˆ†é ä¿¡æ¯
            updatePaginationInfo(history.length);
        }
        
        // æ›´æ–°çµ±è¨ˆæ•¸æ“š
        function updateStats() {
            const history = JSON.parse(localStorage.getItem('qimenMatchHistory') || '[]');
            
            // è¨ˆç®—çµ±è¨ˆæ•¸æ“š
            const total = history.length;
            const verified = history.filter(m => m.actualResult?.verified).length;
            
            let correctResults = 0;
            let correctCorners = 0;
            
            history.forEach(match => {
                if (match.actualResult?.verified && match.predictions?.result) {
                    // è³½æœæº–ç¢ºæ€§
                    const predictedResult = match.predictions.result;
                    const actualResult = getResultFromScore(match.actualResult.finalScore);
                    
                    if (predictedResult === actualResult) {
                        correctResults++;
                    }
                    
                    // è§’çƒæº–ç¢ºæ€§ï¼ˆå…è¨±Â±2èª¤å·®ï¼‰
                    const predCorners = match.predictions.corners;
                    const actualCorners = match.actualResult.corners;
                    if (predCorners && actualCorners) {
                        if (Math.abs(predCorners.home - actualCorners.home) <= 2 &&
                            Math.abs(predCorners.away - actualCorners.away) <= 2) {
                            correctCorners++;
                        }
                    }
                }
            });
            
            // è¨ˆç®—æº–ç¢ºç‡
            const overallAccuracy = verified > 0 ? Math.round(correctResults / verified * 1000) / 10 : 0;
            const resultAccuracy = verified > 0 ? Math.round(correctResults / verified * 1000) / 10 : 0;
            const cornerAccuracy = verified > 0 ? Math.round(correctCorners / verified * 1000) / 10 : 0;
            
            // æ›´æ–°é¡¯ç¤º
            document.getElementById('total-predictions').textContent = total;
            document.getElementById('overall-accuracy').textContent = `${overallAccuracy}%`;
            document.getElementById('result-accuracy').textContent = `${resultAccuracy}%`;
            document.getElementById('corner-accuracy').textContent = `${cornerAccuracy}%`;
            
            // æ›´æ–°é€²åº¦æ¢
            const progressElement = document.getElementById('target-progress');
            const progressPercentage = document.getElementById('progress-percentage');
            const currentProgress = document.getElementById('current-progress');
            const remainingProgress = document.getElementById('remaining-progress');
            
            progressElement.style.width = `${overallAccuracy}%`;
            progressPercentage.textContent = `${overallAccuracy}%`;
            currentProgress.textContent = `${overallAccuracy}%`;
            
            const remaining = Math.max(0, 80 - overallAccuracy);
            remainingProgress.textContent = `${remaining.toFixed(1)}%`;
            
            // æ›´æ–°é¡è‰²
            updateAccuracyColors(overallAccuracy, resultAccuracy, cornerAccuracy);
        }
        
        // å¾æ¯”åˆ†ç²å–çµæœ
        function getResultFromScore(score) {
            if (!score || score === 'å¾…é©—è­‰') return 'æœªçŸ¥';
            
            const [home, away] = score.split('-').map(Number);
            
            if (home > away) return 'ä¸»å‹';
            if (away > home) return 'å®¢å‹';
            return 'å’Œå±€';
        }
        
        // æ›´æ–°æº–ç¢ºç‡é¡è‰²
        function updateAccuracyColors(overall, result, corner) {
            function updateElement(id, value) {
                const element = document.getElementById(id);
                element.className = 'stat-value ';
                
                if (value >= 70) {
                    element.classList.add('accuracy-high');
                } else if (value >= 60) {
                    element.classList.add('accuracy-medium');
                } else {
                    element.classList.add('accuracy-low');
                }
            }
            
            updateElement('overall-accuracy', overall);
            updateElement('result-accuracy', result);
            updateElement('corner-accuracy', corner);
        }
        
        // æŸ¥çœ‹æ¯”è³½è©³æƒ…
        function viewMatchDetail(index) {
            const history = JSON.parse(localStorage.getItem('qimenMatchHistory') || '[]');
            if (index >= 0 && index < history.length) {
                const match = history[index];
                
                // æ§‹å»ºè©³æƒ…HTML
                let html = `
                    <div class="match-detail">
                        <div class="detail-section">
                            <h3>æ¯”è³½åŸºæœ¬ä¿¡æ¯</h3>
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <span class="detail-label">æ¯”è³½ID:</span>
                                    <span class="detail-value">${match.matchId || 'N/A'}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">æ¯”è³½æ™‚é–“:</span>
                                    <span class="detail-value">${new Date(match.matchInfo?.date || match.timestamp).toLocaleString('zh-Hant')}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ä¸»éšŠ:</span>
                                    <span class="detail-value">${match.matchInfo?.homeTeam || 'N/A'}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">å®¢éšŠ:</span>
                                    <span class="detail-value">${match.matchInfo?.awayTeam || 'N/A'}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">è³½äº‹é¡åˆ¥:</span>
                                    <span class="detail-value">${match.matchInfo?.competition || 'N/A'}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h3>é æ¸¬çµæœ</h3>
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <span class="detail-label">è³½æœé æ¸¬:</span>
                                    <span class="detail-value"><strong>${match.predictions?.result || 'N/A'}</strong></span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">è§’çƒé æ¸¬:</span>
                                    <span class="detail-value">${match.predictions?.corners ? `${match.predictions.corners.home}-${match.predictions.corners.away}` : 'N/A'}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">ç½®ä¿¡åº¦:</span>
                                    <span class="detail-value">${match.predictions?.confidence || '0'}%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h3>å¯¦éš›çµæœ</h3>
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <span class="detail-label">æœ€çµ‚æ¯”åˆ†:</span>
                                    <span class="detail-value"><strong>${match.actualResult?.finalScore || 'å¾…é©—è­‰'}</strong></span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">è§’çƒæ•¸:</span>
                                    <span class="detail-value">${match.actualResult?.corners ? `${match.actualResult.corners.home}-${match.actualResult.corners.away}` : 'N/A'}</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">é©—è­‰ç‹€æ…‹:</span>
                                    <span class="detail-value">${match.actualResult?.verified ? 'å·²é©—è­‰' : 'å¾…é©—è­‰'}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h3>AIå­¸ç¿’æ•¸æ“š</h3>
                            <div class="detail-grid">
                                <div class="detail-item">
                                    <span class="detail-label">æº–ç¢ºç‡:</span>
                                    <span class="detail-value"><strong>${match.aiLearning?.accuracy || '0'}%</strong></span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">AIç‰ˆæœ¬:</span>
                                    <span class="detail-value">${match.aiLearning?.version || 'N/A'}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <h3>å¥‡é–€é—œéµæ ¼å±€</h3>
                            <div class="pattern-list">
                                ${(match.qimenData?.specialPatterns || []).map(pattern => `
                                    <div class="pattern-item">${pattern}</div>
                                `).join('') || '<p>ç„¡ç‰¹æ®Šæ ¼å±€è¨˜éŒ„</p>'}
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-actions" style="margin-top: 30px; display: flex; gap: 15px; justify-content: flex-end;">
                        <button class="btn-secondary" onclick="closeDetailModal()">
                            é—œé–‰
                        </button>
                        ${!match.actualResult?.verified ? `
                            <button class="btn-primary" onclick="editMatch(${index}); closeDetailModal();">
                                è¼¸å…¥æ¯”è³½çµæœ
                            </button>
                        ` : ''}
                    </div>
                `;
                
                document.getElementById('modal-title').textContent = `æ¯”è³½è©³æƒ… - ${match.matchId || 'æœªçŸ¥'}`;
                document.getElementById('modal-content').innerHTML = html;
                document.getElementById('detail-modal').style.display = 'flex';
            }
        }
        
        // é—œé–‰è©³æƒ…æ¨¡æ…‹æ¡†
        function closeDetailModal() {
            document.getElementById('detail-modal').style.display = 'none';
        }
        
        // ç·¨è¼¯æ¯”è³½ï¼ˆè¼¸å…¥çµæœï¼‰
        function editMatch(index) {
            const history = JSON.parse(localStorage.getItem('qimenMatchHistory') || '[]');
            if (index >= 0 && index < history.length) {
                const match = history[index];
                
                const score = prompt(`è«‹è¼¸å…¥ ${match.matchInfo?.homeTeam || 'ä¸»éšŠ'} vs ${match.matchInfo?.awayTeam || 'å®¢éšŠ'} çš„æœ€çµ‚æ¯”åˆ†ï¼ˆæ ¼å¼ï¼š2-1ï¼‰:`);
                
                if (score && /^\d+-\d+$/.test(score)) {
                    const homeCorners = prompt(`è«‹è¼¸å…¥ ${match.matchInfo?.homeTeam || 'ä¸»éšŠ'} çš„è§’çƒæ•¸:`);
                    const awayCorners = prompt(`è«‹è¼¸å…¥ ${match.matchInfo?.awayTeam || 'å®¢éšŠ'} çš„è§’çƒæ•¸:`);
                    
                    // æ›´æ–°æ¯”è³½çµæœ
                    match.actualResult = {
                        ...match.actualResult,
                        finalScore: score,
                        corners: {
                            home: parseInt(homeCorners) || 0,
                            away: parseInt(awayCorners) || 0
                        },
                        verified: true,
                        verified_at: new Date().toISOString()
                    };
                    
                    // è¨ˆç®—æº–ç¢ºç‡
                    const accuracy = calculateMatchAccuracy(match);
                    match.aiLearning = {
                        ...match.aiLearning,
                        accuracy: accuracy
                    };
                    
                    // ä¿å­˜æ›´æ–°
                    localStorage.setItem('qimenMatchHistory', JSON.stringify(history));
                    
                    // é‡æ–°åŠ è¼‰æ•¸æ“š
                    loadHistoryData();
                    updateStats();
                    
                    alert(`æ¯”è³½çµæœå·²æ›´æ–°ï¼\næ¯”åˆ†ï¼š${score}\næº–ç¢ºç‡ï¼š${accuracy}%`);
                    
                    // å¦‚æœAIå­¸ç¿’æ¨¡å¡Šå¯ç”¨ï¼Œè§¸ç™¼å­¸ç¿’
                    if (window.AILearning && typeof window.AILearning.learnFromMatch === 'function') {
                        window.AILearning.learnFromMatch(match);
                    }
                } else if (score !== null) {
                    alert('æ¯”åˆ†æ ¼å¼ä¸æ­£ç¢ºï¼Œè«‹ä½¿ç”¨ã€Œæ•¸å­—-æ•¸å­—ã€æ ¼å¼ï¼Œä¾‹å¦‚ï¼š2-1');
                }
            }
        }
        
        // è¨ˆç®—æ¯”è³½æº–ç¢ºç‡
        function calculateMatchAccuracy(matchData) {
            if (!matchData.actualResult?.finalScore || !matchData.predictions?.result) {
                return 0;
            }
            
            const predictedResult = matchData.predictions.result;
            const actualResult = getResultFromScore(matchData.actualResult.finalScore);
            
            // è³½æœæº–ç¢ºæ€§ï¼ˆ70%æ¬Šé‡ï¼‰
            const resultAccuracy = predictedResult === actualResult ? 100 : 0;
            
            // è§’çƒæº–ç¢ºæ€§ï¼ˆ30%æ¬Šé‡ï¼‰
            let cornerAccuracy = 0;
            if (matchData.predictions.corners && matchData.actualResult.corners) {
                const pred = matchData.predictions.corners;
                const actual = matchData.actualResult.corners;
                
                const homeDiff = Math.abs(pred.home - actual.home);
                const awayDiff = Math.abs(pred.away - actual.away);
                
                // å…è¨±Â±2èª¤å·®
                const homeAcc = homeDiff <= 2 ? 100 : Math.max(0, 100 - (homeDiff - 2) * 20);
                const awayAcc = awayDiff <= 2 ? 100 : Math.max(0, 100 - (awayDiff - 2) * 20);
                
                cornerAccuracy = (homeAcc + awayAcc) / 2;
            }
            
            // ç¶œåˆæº–ç¢ºç‡
            const totalAccuracy = (resultAccuracy * 0.7) + (cornerAccuracy * 0.3);
            
            return Math.round(totalAccuracy);
        }
        
        // åˆªé™¤æ¯”è³½è¨˜éŒ„
        function deleteMatch(index) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤æ¯”è³½è¨˜éŒ„å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•æ¢å¾©ã€‚')) {
                const history = JSON.parse(localStorage.getItem('qimenMatchHistory') || '[]');
                if (index >= 0 && index < history.length) {
                    const matchId = history[index].matchId;
                    history.splice(index, 1);
                    localStorage.setItem('qimenMatchHistory', JSON.stringify(history));
                    
                    loadHistoryData();
                    updateStats();
                    
                    alert(`æ¯”è³½ ${matchId} å·²åˆªé™¤ï¼`);
                }
            }
        }
        
        // å°å‡ºæ­·å²æ•¸æ“š
        function exportHistory() {
            const history = JSON.parse(localStorage.getItem('qimenMatchHistory') || '[]');
            const patterns = JSON.parse(localStorage.getItem('qimenPatterns') || '[]');
            const aiParams = JSON.parse(localStorage.getItem('aiParams_v1.1') || '{}');
            
            const exportData = {
                export_info: {
                    exported_at: new Date().toISOString(),
                    system_version: '1.1',
                    data_type: 'æ­·å²æ•¸æ“šå‚™ä»½'
                },
                matches: history,
                patterns: patterns,
                ai_params: aiParams,
                statistics: {
                    total_matches: history.length,
                    verified_matches: history.filter(m => m.actualResult?.verified).length,
                    average_accuracy: calculateAverageAccuracy(history)
                }
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const blob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `å·±åœŸå¥‡é–€æ­·å²æ•¸æ“š_${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('æ­·å²æ•¸æ“šå·²å°å‡ºç‚ºJSONæ–‡ä»¶ï¼');
        }
        
        // è¨ˆç®—å¹³å‡æº–ç¢ºç‡
        function calculateAverageAccuracy(history) {
            const verified = history.filter(m => m.actualResult?.verified);
            if (verified.length === 0) return 0;
            
            const totalAccuracy = verified.reduce((sum, m) => sum + (m.aiLearning?.accuracy || 0), 0);
            return Math.round(totalAccuracy / verified.length * 10) / 10;
        }
        
        // å°å…¥æ­·å²æ•¸æ“š
        function importHistory() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        if (!data.export_info || !data.export_info.system_version) {
                            throw new Error('ç„¡æ•ˆçš„æ•¸æ“šæ ¼å¼');
                        }
                        
                        // åˆä½µæ•¸æ“š
                        if (data.matches && Array.isArray(data.matches)) {
                            const existing = JSON.parse(localStorage.getItem('qimenMatchHistory') || '[]');
                            const merged = [...existing, ...data.matches];
                            
                            // å»é‡ï¼ˆåŸºæ–¼matchIdï¼‰
                            const uniqueMatches = [];
                            const seenIds = new Set();
                            
                            merged.forEach(match => {
                                if (match.matchId && !seenIds.has(match.matchId)) {
                                    seenIds.add(match.matchId);
                                    uniqueMatches.push(match);
                                }
                            });
                            
                            localStorage.setItem('qimenMatchHistory', JSON.stringify(uniqueMatches));
                        }
                        
                        if (data.patterns && Array.isArray(data.patterns)) {
                            const existing = JSON.parse(localStorage.getItem('qimenPatterns') || '[]');
                            const merged = [...existing, ...data.patterns];
                            
                            // å»é‡ï¼ˆåŸºæ–¼pattern nameï¼‰
                            const uniquePatterns = [];
                            const seenNames = new Set();
                            
                            merged.forEach(pattern => {
                                if (pattern.name && !seenNames.has(pattern.name)) {
                                    seenNames.add(pattern.name);
                                    uniquePatterns.push(pattern);
                                }
                            });
                            
                            localStorage.setItem('qimenPatterns', JSON.stringify(uniquePatterns));
                        }
                        
                        // é‡æ–°åŠ è¼‰æ•¸æ“š
                        loadHistoryData();
                        updateStats();
                        
                        alert('æ•¸æ“šå°å…¥æˆåŠŸï¼');
                        
                    } catch (error) {
                        alert(`æ•¸æ“šå°å…¥å¤±æ•—: ${error.message}`);
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // æ¸…é™¤æ‰€æœ‰æ­·å²è¨˜éŒ„
        function clearHistory() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ­·å²è¨˜éŒ„å—ï¼Ÿæ­¤æ“ä½œå°‡åˆªé™¤æ‰€æœ‰æ¯”è³½æ•¸æ“šï¼Œä¸”ç„¡æ³•æ¢å¾©ï¼')) {
                localStorage.removeItem('qimenMatchHistory');
                loadHistoryData();
                updateStats();
                alert('æ‰€æœ‰æ­·å²è¨˜éŒ„å·²æ¸…é™¤ï¼');
            }
        }
        
        // æ›´æ–°åˆ†é ä¿¡æ¯
        function updatePaginationInfo(totalItems) {
            const itemsPerPage = 10; // å‡è¨­æ¯é é¡¯ç¤º10æ¢
            const currentPage = 1; // ç°¡åŒ–ç‰ˆæœ¬ï¼Œå‡è¨­åªæœ‰ä¸€é 
            
            const startIndex = (currentPage - 1) * itemsPerPage + 1;
            const endIndex = Math.min(currentPage * itemsPerPage, totalItems);
            
            document.getElementById('start-index').textContent = startIndex;
            document.getElementById('end-index').textContent = endIndex;
            document.getElementById('total-items').textContent = totalItems;
        }
        
        // æ›´æ–°æœ€å¾Œæ›´æ–°æ™‚é–“
        function updateLastUpdateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-Hant', {
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('last-update-time').textContent = `${now.toLocaleDateString()} ${timeStr}`;
        }
        
        // å…¨å±€å‡½æ•¸å°å‡º
        window.viewMatchDetail = viewMatchDetail;
        window.editMatch = editMatch;
        window.deleteMatch = deleteMatch;
        window.exportHistory = exportHistory;
        window.importHistory = importHistory;
        window.clearHistory = clearHistory;
        window.closeDetailModal = closeDetailModal;
    </script>
</body>
</html>